<!DOCTYPE html>
<html lang="en">
<head>
    <title>axkralj990</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="sidebar.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
</head>
<body style="padding-top: 70px;">

	<nav class="navbar navbar-inverse navbar-fixed-top">
    	<div class="container">

        	<!-- navbar header -->
            <div class="navbar-header">
        		<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mainNavBar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                </button>
            	<a href="http://axkralj990.github.io/" class="navbar-brand">AXKRALJ990</a>
            </div>

            <!-- menu -->
            <div class="collapse navbar-collapse" id="mainNavBar">
            	<ul class="nav navbar-nav">
                	<li><a href="http://axkralj990.github.io/">Home</a></li>
                    	<li><a href="about_me.html">About Me</a></li>
                    	<!-- drop down menu -->
                    	<li class="dropdown active">
                    		<a href="#" class="dropdown-toggle" data-toggle="dropdown">Projects<span class="caret"></span></a>
                        	<ul class="dropdown-menu">
                        		<li><a href="quad.html">ATmega Quadcopter</a></li>
                   			<li><a href="SGM_cs.html">Serial Grahing Monitor - C#</a></li>
                            		<li><a href="SGM_python.html">Serial Graphing Monitor - Python</a></li>
                   			<li><a href="AVR_misc.html">Smaller AVR Projects</a></li>
                        	</ul>
                    	</li>
			<li><a href="https://github.com/axkralj990">GitHub Page</a></li>
                </ul>
            </div>
    	</div>
    </nav>

	<div class="container">
    <div class="row">
      <div class="col-md-8">
    <!--<div class="row">-->
    <p>In my senior year of aerospace engineering I got really interested into control systems and airplane stability and control. Since then I've had the desire to design my own
    flight controller. I found quadcopters the most interesting, since they are unstable and pretty much useless without a closed-loop controller. After learning how to program AVRs,
  I got the idea to write the flight controller on the ATmega328P chip. This is the same chip Arduino Uno uses. The reason I chose to write the controller diretly on the chip with
C instead of using an Arduino, was that I wanted to gain as much knowledge as possible in writing firmware for embedded systems and Arduino environment hides much of the
low-level functions by making the enviroment more user-friendly. I still think that Arduino is a great tool for learning microcontrollers, but working directly with ATmega328 helps to understand
 what's under the hood.</p>

<p>When I started programming AVRs, everything seemed really complex and far from being as user-friendly as Arduino. First thing that scared me was that 660 page long Atmel's user manual. Since it
  is something that you need to refer to the whole time you are programming the chip. After patiently sticking with it for some time it became much friendlier.
As a matter of fact I feel more comfotable programming AVRs than Arduino. I must state that
 <a href="http://www.littlehacks.org/avr-programming">Elliot Williams' book AVR Programming</a> helped me the most to break the ice.</p>

<p>In this project I will cover many different topics that are required for the quad flight controller. I will cover using the analog to digital converter for scanning the flight battery level,
, I2C (TWI) communication protocol between the MPU6050 inertial measurement unit and the ATmega328P, using timers for time measurement required for reading and writing RC signals and PID control,
EEPROM for storing configuration data, USART for configuration and debugging, and much more. As you can see quite many topics need to be covered in order to write the flight
controller, that's why I made a separate repository where I upload programs where I worked on each one of those modules. <a href="AVR_misc.html">This page</a> goes into detail for each one of the modules.</p>

<p>The controller design was greatly inspired by Joop Brokking's <a href="http://www.brokking.net">Youtube channel</a> and <a href="https://www.youtube.com/user/MacPuffdog/featured">blog</a>.
I find his YMFC-3D quadcopter video tutorials of great help and I will refer to them often during the project. The quad components are also almost the same as on the YMFC-3D.</p>

<p>I have also used many libraries from other Github users. All references to the authors are under each subsection of the project where the specific library is used.</p>


<p>As soon as I started reading about mesuring the orientation in space with MPU6050 IMU, I realized
  I needed to make a program that will graph the data sent from the microcontroller via serial port to the computer.
  For that reason I wrote a <a href="#csharp">serial graphing monitor in C#</a>.
  At first<a name="versions"></a> I wrote the <a href="#python">serial graphing monitor in Python 2.7</a>, but I got the desire to learn C# later, so I wrote another one. Both serial graphing programs are described
under projects section</p>
    </div>
    <div class="col-md-4">
      <div class="panel panel-default">
        <div class="panel-heading">Contents</div>
        <div class="panel-body">
          <ol>
            <li><a href="quad.html">Overview</a></li>
            <li><a href="#versions">Firmware Versions</a></li>
            <li><a href="#serialMonitor">Serial Graphing Monitor</a></li>
            <li><a href="#">Orientation Sensing</a></li>
            <li><a href="#">RC control</a></li>
            <li><a href="#">Quadcopter components</a></li>
            <li><a href="#">Firmware</a></li>
            <li><a href="#">Flight Controller Board</a></li>
            <li><a href="#">Future Improvements</a></li>
          </ol>
        </div>
      </div>
    </div>
    </div>

    <a name="python"></a>

<h2>Firmware Versions</h2>

<h3>Version 1.0</h3>
<p>As of October 31, I am working on the very first version of the firmware, so
I will just call it version 1.0.</p>

<p>For the version 1.0 I will use the Arduino Uno board and Adafruit SD
card shiled configured with the MPU6050 IMU, receiver inputs and ESC outputs.
Of course I will program the ATmega328P on the Arduino with plain C using
 Atmel Studio and not Arduino's C/C++ dialect. The main reson I am using the Arduino
 for the first version is that I still have to figure out the best way to convert
 the voltage from roughly 12V from the flight battery to 5V that the chip needs.
 Another reason for using this hardware configuration is the 16MHz crystal
 oscillator built on the Arduino Uno. Because the flight control requires precise
 time measurements (reading and generating RC controll pulses and PID control),
 the internal RC oscillator of the ATmega328P lacks precission. I realized that
 when I compared pulse lengths from RC receiver with the same code running on
 the Arduino and on the standalone ATmega328P chip. The maximum pulse length
 the Arduino read was exactly 2000ms long, while the standalone chip read
only approximatelly 1800ms.</p>

<a name="serialMonitor"></a>

<p>I plan on designing the flight controller board myself for later versions,
 but I will have to learn some more about voltage regulators and I will have to
 install the 16MHz crystall oscillator for better time measurements and pulse
 generation.</p>

<h2>Serial Graphing Monitor</h2>

<p>Descriptions of both serial graphing monitors are on the following pages.</p>
<ul>
  <li><a href="SGM_cs.html">Serial Graphing Monitor - C#</a></li>
  <li><a href="SGM_python.html">Serial Graphing Monitor - Python</a></li>
</ul>

<div class="row" style="padding-bottom: 30px;">
  <div class="col-md-6">
  <img src="Monitor.jpg" height="500">
  </div>

  <div class="col-md-6">
    <img src="MonitorC.JPG" height="500">
  </div>
</div>

<div class="row">
<h2>Libraries for ATmega328 and Arduino</h2>
<p><h3>1. AK_MPU6050_lib for ATmega328: </h3> I am working on a library to use MPU6050 IMU with ATmega328P chip. As of September 19, 2016 the library contains the following functions:</p>

<ul>
  <li>MPU6050_init()</li>
  <li>MPU6050_test_I2C()</li>
  <li>MPU6050_get_accel()</li>
  <li>MPU6050_get_gyro()</li>
  <li>MPU6050_set_sleepMode()</li>
  <li>MPU6050_set_gyroFS()</li>
  <li>MPU6050_set_accelFS()</li>
  <li>MPU6050_set_clockSource()</li>
</ul>

<p>The AK_MPU6050_lib uses <a href="https://github.com/g4lvanix/I2C-master-lib">I2c-master-lib by g4lvanix</a> for I2C communication with the MPU6050 chip.</p>

<h3>2. USART library for ATmega328: </h3>

<p>This is a slightly modified version of a USART library written by Elliot Williams for his <a href="http://www.littlehacks.org/avr-programming">AVR Programming book</a>. I must note that I have learned most of my AVR programming knowledge from this book and I highly recommend it.</p>

<h2>Quadcopter Components</h2>

<p>I have finally received all the components for the quad. I bought almost everything from <a href="http://www.brokking.net/ymfc-al_main.html">Brokking's list</a> for his YMFC-3D AL quadcopter. Links to each part at dx.com are on his website. The only thing I bought in my local RC store was the LiPo charger and the batttery, since LiPo batteries could not be shipped to EU from dx.net.</p>

<p>First problem I ran into was that I had no idea on how to work with LiPo batteries, since they be quite dangerous if not handled properly. <a href="http://www.tjinguytech.com/charging-how-tos">This link</a> taught me all I needed for now.</p>

<p>I have also bought all the miscallaneous components, such as heat-shrink tubes, various cables, etc. I will be posting the complete parts list soon.</p>

<p>Author: alex.kraljic@gmail.com</p>

<p>There is still a lot to fix, add, and improve, so any suggestions and corrections are welcome!</p>
</div>
<!--</div>-->
	<hr>
      <footer>
        <p>&copy; 2016 Company, Inc.</p>
      </footer>
    </div> <!-- /container -->
</body>
</html>
